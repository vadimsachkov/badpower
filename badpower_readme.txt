Автор: Вадим Сачков
Программа: badpower — инструмент для выполнения нужной команды, если заданный хост долгое время недоступен.

Создана для автоматического отключения питания при потере связи с хостом. Например, если пропало электричество, и ИБП держит питание, программа может инициировать выключение сервера, чтобы не допустить аварийного отключения.

Описание:
Эта консольная программа отслеживает указанный IP-адрес на наличие ожидаемого MAC-адреса в ARP-таблице системы.
Если MAC-адрес не обнаружен в течение заданного времени, и система работает дольше указанного порога, выполняется заданная пользователем команда (например, выключение с помощью shutdown).

Последняя успешная ARP-фиксация сохраняется в отдельном `.txt`-файле.
Все действия логируются в ежемесячные лог-файлы. Старые логи автоматически удаляются через 1 год.

Программа требует C++17:
Project Properties → C/C++ → Language → C++ Language Standard → ISO C++17 (/std:c++17)

Пример запуска:
badpower.exe -ip 190.190.32.11 -mac 90-4E-2B-CA-0A-53 -clear -wait_min 120 -uptime_min 20 -pathlog "C:\temp" -exec "shutdown /s /t 180 /c \"badpower script has initiated automatic shutdown because the Huawei router at 190.190.32.11 has not responded for a long time, possibly due to a power outage.\""

События в журнале Windows:
- ID 1074 — обычное завершение работы (например, через shutdown.exe). В описании будет текст из параметра /c.
- ID 1075 — отмена выключения командой shutdown -a.

Справка по параметрам:

Usage: badpower [options]

Required Parameters:
  -ip <ip_address>          IP-адрес отслеживаемого устройства (например, 192.168.1.100)
  -mac <mac_address>        Ожидаемый MAC-адрес (например, AA-BB-CC-DD-EE-FF)
  -wait_min <minutes>       Максимальное время отсутствия MAC в минутах
  -uptime_min <minutes>     Минимальный аптайм системы в минутах
  -exec "<command>"         Команда, выполняемая при соблюдении условий
  -pathlog <path>           Путь к папке для логов и файла с меткой

Optional:
  -prefix <name>            Имя вместо IP в файлах (фильтруются недопустимые символы)
  -clear                    Удалить файл метки перед выполнением команды. Позволяет не зацикливаться
  -?                        Показать справку
